#!/bin/bash

# map taken from cm-super/README, except sftex (changed to sftt - absent in cm-super) and sfssdc1000 (changed to sfssdc10 - to avoid name clash of vf/cmssdc10.tfm with TeXfonts/cmssdc10.tfm)
MAP=(
  "cmbl1000:cmbxsl10"
  "cmbi1000:cmbxti10"
  "cmbx1000:cmbx10"
  "cmbx1200:cmbx12"
  "cmbx0500:cmbx5"
  "cmbx0600:cmbx6"
  "cmbx0700:cmbx7"
  "cmbx0800:cmbx8"
  "cmbx0900:cmbx9"
  "cmrb1000:cmb10"
  "cmdh1000:cmdunh10"
  "cmff1000:cmff10"
  "cmfb0800:cmfib8"
  "cmfi1000:cmfi10"
  "cmrm1000:cmr10"
  "cmrm1200:cmr12"
  "cmrm1728:cmr17"
  "cmrm0600:cmr6"
  "cmrm0700:cmr7"
  "cmrm0800:cmr8"
  "cmrm0900:cmr9"
  "cmsl1000:cmsl10"
  "cmsl1200:cmsl12"
  "cmsl0800:cmsl8"
  "cmsl0900:cmsl9"
  "cmsx1000:cmssbx10"
  "cmsi1000:cmssi10"
  "cmsi1200:cmssi12"
  "cmsi1728:cmssi17"
  "cmsi0800:cmssi8"
  "cmsi0900:cmssi9"
  "cmss1000:cmss10"
  "cmss1200:cmss12"
  "cmss1728:cmss17"
  "cmss0800:cmss8"
  "cmss0900:cmss9"
  "cmti1000:cmti10"
  "cmti1200:cmti12"
  "cmti0700:cmti7"
  "cmti0800:cmti8"
  "cmti0900:cmti9"
  "cmui1000:cmu10"
  "cmvt1000:cmvtt10"
  "cmcc1000:cmcsc10"
  "cmrm0500:cmr5"
  "cmit1000:cmitt10"
  "cmst1000:cmsltt10"
  "cmtc1000:cmtcsc10"
  "cmtt1000:cmtt10"
  "cmtt1200:cmtt12"
  "cmtt0800:cmtt8"
  "cmtt0900:cmtt9"
  "cmtex1000:cmtex10"
  "cmtex0800:cmtex8"
  "cmtex0900:cmtex9"
  "cmssdc1000:cmssdc10"
  "cmqi8:cmssqi8"  
  "cmsq8:cmssq8"
)

echo '% this file was automatically generated by gen-vf' >~/lhplain/omfonts.map
cd /tmp
rm -fr vf
mkdir vf
cd vf
rm -fr ~/lhplain/vf ~/lhplain/tfm
mkdir ~/lhplain/vf ~/lhplain/tfm
for i in "${MAP[@]}"; do ##############################
cm=${i%:*}
om=o${i#*:c}
printf '%s %s <%s.pfb\n' $cm $(echo $om|tr '[a-z]' '[A-Z]') $om >>~/lhplain/omfonts.map
printf 'o%s SF%s "OMEncoding ReEncodeFont" <cm-super-om.enc <sf%s.pfb\n' ${cm#c} $(echo ${cm#cm}|tr '[a-z]' '[A-Z]') ${cm#cm} >>~/lhplain/omfonts.map
tftopl ~/tex/TeXfonts/$om.tfm >$om.vpl
sed -i "1i\
(MAPFONT D 0 (FONTNAME $cm))\
(MAPFONT D 1 (FONTNAME o${cm#c}))" $om.vpl
sed -i 's/^(CHARACTER O \([23][0-9][0-9]\)/&\n   (MAP\n      (SELECTFONT D 1)\n      (SETCHAR O \1)\n      )/' $om.vpl
cp ~/tex/TeXfonts/omtt10.tfm $cm.tfm # for vptovf
cp ~/tex/TeXfonts/omtt10.tfm o${cm#c}.tfm # for vptovf
vptovf $om.vpl
cp $om.vf ~/lhplain/vf/
ln -s ~/tex/TeXfonts/$om.tfm ~/lhplain/tfm/$cm.tfm
ln -s ~/tex/TeXfonts/$om.tfm ~/lhplain/tfm/o${cm#c}.tfm
done ###################################################################
sed -i '/^omtex/{s/SFTEX/SFTT/;s/<sftex/<sftt/}' ~/lhplain/omfonts.map
sed -i '/^omssdc1000/{s/SFSSDC1000/SFSSDC10/;s/sfssdc1000/sfssdc10/}' ~/lhplain/omfonts.map
