#!/bin/sh
cd /tmp; rm -fr vf ~/lhplain/vf ~/lhplain/tfm; mkdir vf ~/lhplain/vf ~/lhplain/tfm; cd vf
echo '% this file was automatically generated by gen-vf' >~/lhplain/omfonts.map

# this correspondence between SF and CM for fonts in MFinputs/om/ was created using cm-super/README;
# cmtex are absent in SF - I add them here and change to them tt in the end of this script

MAP=(
  sfbl1000:cmbxsl10
  sfbi1000:cmbxti10
  sfbx1000:cmbx10
  sfbx1200:cmbx12
  sfbx0500:cmbx5
  sfbx0600:cmbx6
  sfbx0700:cmbx7
  sfbx0800:cmbx8
  sfbx0900:cmbx9
  sfrb1000:cmb10
  sfdh1000:cmdunh10
  sfff1000:cmff10
  sffb0800:cmfib8
  sffi1000:cmfi10
  sfrm1000:cmr10
  sfrm1200:cmr12
  sfrm1728:cmr17
  sfrm0600:cmr6
  sfrm0700:cmr7
  sfrm0800:cmr8
  sfrm0900:cmr9
  sfsl1000:cmsl10
  sfsl1200:cmsl12
  sfsl0800:cmsl8
  sfsl0900:cmsl9
  sfsx1000:cmssbx10
  sfsi1000:cmssi10
  sfsi1200:cmssi12
  sfsi1728:cmssi17
  sfsi0800:cmssi8
  sfsi0900:cmssi9
  sfss1000:cmss10
  sfss1200:cmss12
  sfss1728:cmss17
  sfss0800:cmss8
  sfss0900:cmss9
  sfti1000:cmti10
  sfti1200:cmti12
  sfti0700:cmti7
  sfti0800:cmti8
  sfti0900:cmti9
  sfui1000:cmu10
  sfvt1000:cmvtt10
  sfcc1000:cmcsc10
  sfrm0500:cmr5
  sfit1000:cmitt10
  sfst1000:cmsltt10
  sftc1000:cmtcsc10
  sftt1000:cmtt10
  sftt1200:cmtt12
  sftt0800:cmtt8
  sftt0900:cmtt9
  sftex1000:cmtex10
  sftex0800:cmtex8
  sftex0900:cmtex9
  sfssdc10:cmssdc10
  sfqi8:cmssqi8
  sfsq8:cmssq8
)

for i in "${MAP[@]}"
do
  sf=${i%:*}
  om=o${i#*:c}
  printf '%s %s <%s.pfb\n' $sf $(echo c${om#o}|tr '[a-z]' '[A-Z]') c${om#o} >>~/lhplain/omfonts.map
  printf 'om%s SF%s "OMEncoding ReEncodeFont" <cm-super-om.enc <sf%s.pfb\n' ${sf#sf} $(echo ${sf#sf}|tr '[a-z]' '[A-Z]') ${sf#sf} >>~/lhplain/omfonts.map
  tftopl ~/tex/TeXfonts/$om.tfm >$om.vpl
  dsize=$(sed -n 's/^(DESIGNSIZE/(FONTDSIZE/p' $om.vpl)
  sed -i "1i (MAPFONT D 0 (FONTNAME $sf) $dsize)" $om.vpl
  sed -i "1a (MAPFONT D 1 (FONTNAME om${sf#sf}) $dsize)" $om.vpl
  sed -i 's/^(CHARACTER O \([23][0-9][0-9]\)/&\n   (MAP (SELECTFONT D 1) (SETCHAR O \1))/' $om.vpl
  cp ~/tex/TeXfonts/omtt10.tfm $sf.tfm # for vptovf
  cp ~/tex/TeXfonts/omtt10.tfm om${sf#sf}.tfm # for vptovf
  vptovf $om.vpl
  cp $om.vf ~/lhplain/vf/
  ln -s ~/tex/TeXfonts/$om.tfm ~/lhplain/tfm/$sf.tfm
  ln -s ~/tex/TeXfonts/$om.tfm ~/lhplain/tfm/om${sf#sf}.tfm
done
# see comment in beginning of this script:
sed -i 's/SFTEX/SFTT/;s/<sftex/<sftt/' ~/lhplain/omfonts.map
